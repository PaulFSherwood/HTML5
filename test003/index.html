<!doctype html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, minimum-scale=1, user-scalable=no">

	<meta name="apple-mobile-web-app-capable" content="yes">
	<meta name="mobile-web-app-capable" content="yes">

	<title>FlappyJS</title>

	<script src="sprite.js"></script>

	<style>
	canvas {
		display: block;
		position: absolute;
		margin: auto;
		top: 0;
		bottom: 0;
		left: 0;
		right: 0;
	}
	</style>
</head>
<body>
<script>

var

// Game vars //

canvas,
ctx,
width,
height,

fgpos = 0,
frames = 0,
score = 0,
best = localStorage.getItem("best") || 0,

// State vars //

currentstate,
states = {
	Splash: 0, Game: 1, Score: 2
},

// Game objects

/**
  * Ok button initiated in main()
  */
okbtn,


/**
  * The bird 
  */
bird = {

},

pipes = {

};

function main() {
    // create canvas and set width/height
	canvas = document.createElement("canvas");

	width = window.innerWidth;
	height = window.innerHeight;

   if (width >= 500) {
		width  = 320;
		height = 480;
		canvas.style.border = "1px solid #000";
    }

    canvas.width = width;
	canvas.height = height;
	if (!(!!canvas.getContext && canvas.getContext("2d"))) {
		alert("Your browser doesn't support HTML5, please update to latest version");
	}
	ctx = canvas.getContext("2d");

    // append canvas to document
	document.body.appendChild(canvas);

    var img = new Image();
    img.onload = function() {
        initSprites(this);
        ctx.fillStyle = s_bg.color; // fill in the background color
        run();
    }
    img.src = "res/sheet.png";

}

function run() {
    var loop = function() {
        update();
        render();
        window.requestAnimationFrame(loop, canvas);
    }
    window.requestAnimationFrame(loop, canvas);
}

function update(){
    frames++;

    fgpos = (fgpos - 2) % 14;
}

function render() {
    ctx.fillRect(0, 0, width, height);  // fill in the background color
    s_bg.draw(ctx, 0, height - s_bg.height ); // initial picture
    s_bg.draw(ctx, s_bg.width, height - s_bg.height ); // fill in the gap

    s_fg.draw(ctx, fgpos, height - s_fg.height); // forground picture
    s_fg.draw(ctx, fgpos+s_fg.width, height - s_fg.height); // fill in the rest of the forground
}

main();

</script>
</body>
</html>
